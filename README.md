# 賃貸顧客管理システム v2.0

## 📋 概要

賃貸不動産管理業務を効率化するためのデスクトップアプリケーションです。顧客管理、物件管理、契約管理、書類管理、タスク管理、接点履歴管理、整合性チェック機能を統合し、OCR技術を活用した自動化機能も備えています。

### 🆕 v2.0 新機能

- **Document Type の詳細分類**: 9種類の書類種別を管理
- **Allowed Uses（使用条件・制限）管理**: 部屋ごとの使用条件を詳細管理
- **Reference Properties（参考物件）機能**: 相場比較用の外部物件データ管理
- **整合性チェック機能**: 登記簿・行政資料との自動整合性チェック

## 🚀 主な機能

### 1. 顧客管理
- 顧客基本情報の登録・編集・削除
- テナント提出書類の管理
- Q&Aログの記録
- 最終接触日の自動更新
- 顧客との接点履歴管理

### 2. 物件管理
- 建物単位での物件情報管理
- 物件種別、総部屋数、家賃単価の記録
- 都市計画情報の管理
- 物件ごとの詳細情報管理

### 3. 部屋管理（拡張版）
- 部屋・階層単位での詳細管理
- 部屋番号、階層、部屋タイプの管理
- 賃料、敷金、礼金、管理費の設定
- **使用条件・制限の詳細管理**:
  - 重飲食可/不可
  - 深夜営業可/不可
  - ペット可/不可
  - 民泊可/不可
  - 24時間利用可/不可
  - その他の使用条件・制限

### 4. 契約管理（拡張版）
- 部屋単位での契約管理
- 普通契約・定期契約の区別
- 契約日、開始日、終了日、更新期日の管理
- 更新or再契約の選択
- 手数料率の設定
- 契約状況の管理

### 5. 書類管理（拡張版）
- **9種類の書類種別管理**:
  - 契約書（定期・普通含む）
  - 重要事項説明書
  - 登記簿謄本（建物・土地）
  - 申込書
  - リフォーム等の見積書
  - 鍵の預り証
  - メール履歴（txtなど）
  - 都市計画・用途地域資料
  - その他
- OCR機能による自動テキスト抽出
- 手動編集機能
- OCR結果の検証フラグ

### 6. チェックリスト管理（拡張版）
- 重要事項説明書の必須項目チェック
- 必須項目・任意項目の分類
- 自動判定フラグ
- チェック状況の管理
- 備考欄での詳細記録

### 7. タスク管理
- 契約関連タスクの管理
- タスク種別：更新案内、請求、通知、その他
- 期限、優先度、担当者の設定
- タスク状況の管理
- 期限超過タスクの赤色ハイライト

### 8. 接点履歴管理
- 顧客との接点記録
- 接点種別：電話、メール、面談、その他
- 件名、内容、接触日の記録
- 次回アクションの設定
- 契約との関連付け

### 9. 整合性チェック（新機能）
- **登記簿・行政資料との整合性チェック**
- OCRによる自動データ抽出
- DB登録値との比較
- 不一致箇所の赤色ハイライト
- チェック履歴の管理
- チェック項目：
  - 登記簿：所在地、構造、階数、面積、所有者氏名
  - 行政資料：都市計画用途、接道、容積率、建蔽率、用途地域

### 10. 参考物件管理（新機能）
- **相場比較用の外部物件データ管理**
- 面積、賃料、管理費、単価の記録
- OCR元のPDFとの関連付け
- 面積範囲での検索機能

## 🛠️ 技術仕様

### 開発環境
- **言語**: Python 3.8+
- **GUIフレームワーク**: PyQt6
- **データベース**: SQLite3
- **OCRエンジン**: Google Gemini Vision API

### 必要なライブラリ
```
PyQt6>=6.0.0
requests>=2.25.0
python-dotenv>=0.19.0
Pillow>=8.0.0
```

### ファイル構成
```
tintaikanri/
├── run.py                 # メイン実行ファイル
├── main_window.py         # メインウィンドウ
├── models.py              # データベースモデル
├── gemini_ocr.py          # OCR機能
├── customer_tab.py        # 顧客管理タブ
├── property_tab.py        # 物件管理タブ
├── unit_tab.py           # 部屋管理タブ
├── contract_tab.py       # 契約管理タブ
├── document_tab.py       # 書類管理タブ
├── checklist_tab.py      # チェックリストタブ
├── task_tab.py           # タスク管理タブ
├── communication_tab.py  # 接点履歴タブ
├── consistency_check_tab.py # 整合性チェックタブ
├── requirements.txt      # 依存関係
├── .env                  # 環境変数（APIキー）
└── README.md            # このファイル
```

## 📦 インストール方法

### 1. リポジトリのクローン
```bash
git clone <repository-url>
cd tintaikanri
```

### 2. 依存関係のインストール
```bash
pip install -r requirements.txt
```

### 3. 環境変数の設定
`.env`ファイルを作成し、Gemini APIキーを設定：
```
GEMINI_API_KEY=your_api_key_here
```

### 4. アプリケーションの起動
```bash
python run.py
```

## 📖 使用方法

### 基本的なワークフロー

1. **物件・部屋の登録**
   - 物件管理タブで建物を登録
   - 部屋管理タブで各部屋の詳細情報と使用条件を設定

2. **顧客の登録**
   - 顧客管理タブで顧客情報を登録
   - テナント提出書類やQ&Aログを記録

3. **契約の締結**
   - 契約管理タブで部屋と顧客を関連付け
   - 契約条件を設定

4. **書類の管理**
   - 書類管理タブで関連書類をアップロード
   - OCR機能で自動テキスト抽出
   - 必要に応じて手動編集

5. **整合性チェック**
   - 整合性チェックタブで登記簿・行政資料をアップロード
   - 自動チェックでDB登録値との整合性を確認
   - 不一致箇所を確認・修正

6. **タスク・接点の管理**
   - タスク管理タブで契約関連タスクを登録
   - 接点履歴タブで顧客との接触を記録

### OCR機能の使用方法

1. 書類管理タブでファイルを選択
2. 「OCR実行」ボタンをクリック
3. 自動抽出されたテキストを確認
4. 必要に応じて手動編集
5. 「書類登録」で保存

### 整合性チェックの使用方法

1. 整合性チェックタブで契約を選択
2. チェック種別（登記簿謄本/行政資料）を選択
3. ファイルをアップロード
4. 「整合性チェック実行」ボタンをクリック
5. 結果を確認し、不一致箇所を修正

## 🗄️ データベース構造

### テーブル一覧（10テーブル）

1. **customers** - 顧客情報
2. **properties** - 物件情報
3. **units** - 部屋・階層情報（使用条件含む）
4. **tenant_contracts** - 賃貸契約情報
5. **documents** - 書類情報（9種類の書類種別）
6. **tasks** - タスク情報
7. **checklist_status** - チェックリスト項目
8. **communications** - 接点履歴
9. **reference_properties** - 参考物件情報（新規）
10. **consistency_checks** - 整合性チェック結果（新規）

### 主要フィールド

#### units テーブル（拡張）
```sql
- is_food_allowed: 重飲食可
- is_midnight_allowed: 深夜営業可
- is_pet_allowed: ペット可
- is_minpaku_allowed: 民泊可
- is_24h_allowed: 24時間利用可
- allowed_uses_notes: その他の使用条件
```

#### documents テーブル（拡張）
```sql
- document_type: DocumentType Enum（9種類）
- ocr_edited: 手動編集されたOCR結果
- is_verified: OCR結果の検証済みフラグ
```

#### reference_properties テーブル（新規）
```sql
- address: 住所
- area: 面積
- rent: 賃料
- maintenance_fee: 管理費
- unit_price: 単価
- source_document_id: OCR元のPDF
- ocr_extracted: OCR抽出済みフラグ
```

#### consistency_checks テーブル（新規）
```sql
- check_item: チェック項目名
- document_type: 書類種別
- extracted_value: 抽出結果
- db_value: DB登録値
- is_consistent: 一致フラグ
- notes: 備考
```

## 🔧 トラブルシューティング

### よくある問題

1. **アプリケーションが起動しない**
   - Python 3.8以上がインストールされているか確認
   - 必要なライブラリがインストールされているか確認

2. **OCR機能が動作しない**
   - `.env`ファイルに正しいAPIキーが設定されているか確認
   - インターネット接続を確認

3. **データベースエラーが発生**
   - `tintai_management.db`ファイルを削除して再作成

4. **ファイルが読み込めない**
   - ファイルパスに日本語が含まれていないか確認
   - ファイルの権限を確認

### ログの確認
エラーが発生した場合は、コンソール出力を確認してください。

## 📈 更新履歴

### v2.0.0 (2024-12-19)
- **Document Type の詳細分類**を追加（9種類）
- **Allowed Uses（使用条件・制限）管理**を追加
- **Reference Properties（参考物件）機能**を追加
- **整合性チェック機能**を追加
- データベース構造を拡張
- UI/UXの向上

### v1.1.0 (2024-12-18)
- 部屋管理機能を追加
- タスク管理機能を追加
- 接点履歴管理機能を追加
- データベース構造を正規化

### v1.0.0 (2024-12-17)
- 初回リリース
- 基本的な顧客・物件・契約・書類管理機能
- OCR機能の実装

## 🤝 貢献

プロジェクトへの貢献を歓迎します。以下の方法で貢献できます：

1. バグレポートの提出
2. 機能要求の提案
3. プルリクエストの送信
4. ドキュメントの改善

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 📞 サポート

問題や質問がある場合は、GitHubのIssuesページで報告してください。

---

**開発者**: AI Assistant  
**最終更新**: 2024年12月19日  
**バージョン**: 2.0.0 